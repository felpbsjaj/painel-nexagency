<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexAgency - Sistema de Afiliados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #0f172a; font-family: 'Inter', sans-serif; color: white; margin: 0; }
        .sidebar { background-color: #1a2235; border-right: 1px solid #2d3748; height: 100vh; position: sticky; top: 0; }
        .card-stat { background-color: transparent; border: 1px solid #334155; border-radius: 12px; padding: 20px; display: flex; align-items: center; gap: 16px; }
        .text-label { color: #94a3b8; font-size: 13px; font-weight: 600; }
        /* Todos os números em branco conforme pedido */
        .text-value { font-size: 26px; font-weight: 800; color: #ffffff; }
        /* Borda azul para o card de CPA */
        .highlight-blue { border: 1px solid #3b82f6 !important; }
        .modal-content { background-color: #1a2235; border: 1px solid #334155; width: 450px; }
        .input-data { background-color: #0f172a; border: 1px solid #334155; padding: 12px; border-radius: 8px; width: 100%; color: white; outline: none; }
        /* Estilo Toast (Notificação bonitinha) */
        #toast { visibility: hidden; min-width: 250px; background-color: #a3e635; color: #0f172a; text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 200; bottom: 30px; left: 50%; transform: translateX(-50%); font-weight: 700; }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body class="flex">

    <aside class="w-64 sidebar hidden md:flex flex-col p-6">
        <img src="https://res.cloudinary.com/dsreg6hmo/image/upload/v1767891428/BetBoard/Photos/gpkghm2vdoohymfufbuw.png" class="h-8 mb-10 w-fit">
        <nav class="space-y-4 flex-1">
            <p class="text-slate-500 text-[10px] font-bold uppercase tracking-widest">Menu Principal</p>
            <button onclick="mudarTab('overview')" class="flex items-center w-full text-blue-400 p-3 rounded-lg border-l-4 border-blue-500 bg-slate-800/20">
                <i data-lucide="layout-dashboard" class="mr-3 w-5 h-5"></i> Overview
            </button>
        </nav>
        <button onclick="logout()" class="flex items-center text-slate-500 hover:text-red-400 p-3 transition border-t border-slate-700 pt-6">
            <i data-lucide="log-out" class="mr-3 w-5 h-5"></i> Sair
        </button>
    </aside>

    <main class="flex-1 p-8">
        <header class="flex justify-between items-center mb-6">
            <h2 id="titulo-pagina" class="text-2xl font-bold">Overview</h2>
            <div class="relative">
                <button onclick="toggleDropdown()" class="flex items-center gap-3 bg-transparent p-1 px-4 rounded-full border border-slate-700 hover:border-blue-500 transition">
                    <span id="top-user-name" class="text-sm font-medium text-slate-300 uppercase">...</span>
                    <div id="avatar-inicial" class="h-9 w-9 bg-slate-600 rounded-full flex items-center justify-center text-sm font-bold border border-blue-500 text-white">?</div>
                </button>
                <div id="dropdown" class="hidden absolute right-0 mt-2 w-48 bg-slate-800 border border-slate-700 rounded-xl z-50 overflow-hidden shadow-2xl">
                    <button onclick="mudarTab('perfil')" class="flex items-center w-full p-4 text-sm text-slate-300 hover:bg-slate-700">
                        <i data-lucide="user-circle" class="mr-3 w-4 h-4 text-lime-400"></i> Meu Perfil
                    </button>
                    <button onclick="logout()" class="flex items-center w-full p-4 text-sm text-red-400 hover:bg-slate-700 border-t border-slate-700">
                        <i data-lucide="log-out" class="mr-3 w-4 h-4"></i> Sair
                    </button>
                </div>
            </div>
        </header>

        <div id="filtros-topo" class="mb-8">
            <button onclick="abrirModalFiltro()" class="flex items-center gap-2 px-4 py-2 bg-transparent border border-slate-700 rounded-md text-slate-400 hover:border-lime-400 transition">
                <i data-lucide="calendar" class="w-4 h-4 text-lime-400"></i>
                <span id="periodo-exibicao" class="text-xs font-medium uppercase">...</span>
            </button>
        </div>

        <div id="secao-overview" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="card-stat"><img src="icones/rgst.svg" class="h-12"><div><p class="text-label uppercase">Registro</p><h3 id="registros" class="text-value">0</h3></div></div>
            <div class="card-stat"><img src="icones/FTD-BkwOULkh.svg" class="h-12"><div><p class="text-label uppercase">FTD</p><h3 id="ftd" class="text-value">0</h3></div></div>
            <div class="card-stat"><img src="icones/FTD-BkwOULkh.svg" class="h-12"><div><p class="text-label uppercase">QFTD</p><h3 id="qftd" class="text-value">0</h3></div></div>
            <div class="card-stat"><img src="icones/deposito-BqL6OVL2.svg" class="h-12"><div><p class="text-label uppercase">Depósito</p><h3 id="depositos" class="text-value">R$ 0,00</h3></div></div>
            <div class="card-stat"><img src="icones/Rev-Cd_d35Vr.svg" class="h-12"><div><p class="text-label uppercase">REV</p><h3 class="text-value">R$ 0,00</h3></div></div>
            <div class="card-stat highlight-blue">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-hand-coins"><path d="M11 15h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 17"/><path d="m7 21 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-5.4a2 2 0 0 0-2.8-2.8L14 14"/><circle cx="16" cy="3" r="2"/><path d="M12 7h.01"/></svg>
                <div><p class="text-label text-blue-400 uppercase">CPA</p><h3 id="cpa" class="text-value">R$ 0,00</h3></div>
            </div>
            <div class="card-stat"><img src="icones/cprev.svg" class="h-12"><div><p class="text-label uppercase">REV + CPA</p><h3 id="total" class="text-value">R$ 0,00</h3></div></div>
        </div>

        <div id="secao-perfil" class="hidden max-w-4xl mx-auto">
            <div class="bg-[#1a2235] border border-slate-700 p-10 rounded-2xl text-center">
                <div id="avatar-perfil-grande" class="h-32 w-32 bg-slate-700 rounded-full mx-auto mb-6 flex items-center justify-center text-4xl font-bold border-4 border-slate-600 relative">?</div>
                <h2 class="text-2xl font-bold mb-4 uppercase tracking-tight">NEX AGENCY - <span id="perfil-nome-grande">...</span></h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left mt-8">
                    <div class="card-stat border-slate-800"><div><p class="text-label uppercase">Nome</p><p class="font-bold">NEX AGENCY -</p></div></div>
                    <div class="card-stat border-slate-800"><div><p class="text-label uppercase">Sobrenome</p><p id="perfil-sobrenome" class="font-bold uppercase">...</p></div></div>
                    <div class="card-stat border-slate-800"><div><p class="text-label uppercase">Cargo</p><p class="font-bold text-green-400">Afiliado</p></div></div>
                    <div class="card-stat border-slate-800"><div><p class="text-label uppercase">E-mail</p><p class="font-bold text-slate-300">nexagency@affiliates.com</p></div></div>
                </div>
            </div>
        </div>
    </main>

    <div id="modal-filtro" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/80">
        <div class="modal-content p-8 rounded-xl relative">
            <button onclick="fecharModalFiltro()" class="absolute top-4 right-4 text-slate-500 hover:text-white">✕</button>
            <h3 class="text-xl font-bold mb-8">Filtrar por Período</h3>
            <div class="space-y-6">
                <div><label class="block text-xs font-bold text-slate-500 mb-2 uppercase">Data de Início</label><input type="date" id="modal-ini" class="input-data"></div>
                <div><label class="block text-xs font-bold text-slate-500 mb-2 uppercase">Data de Término</label><input type="date" id="modal-fim" class="input-data"></div>
            </div>
            <div class="flex gap-4 mt-10">
                <button onclick="fecharModalFiltro()" class="flex-1 bg-slate-800 py-3 rounded-lg font-bold">Cancelar</button>
                <button onclick="aplicarFiltroLocal()" class="bg-[#a3e635] text-[#0f172a] flex-1 py-3 rounded-lg font-bold">Aplicar Filtros</button>
            </div>
        </div>
    </div>

    <div id="toast">Filtros de data aplicados</div>

    <script>
        // Configurações Firebase omitidas para brevidade, mas devem permanecer as mesmas
        const db = firebase.database();
        const user = localStorage.getItem('usuarioLogado');
        if(!user) window.location.href = 'index.html';

        const inicial = user.charAt(0).toUpperCase();
        document.getElementById('avatar-inicial').innerText = inicial + "-";
        document.getElementById('top-user-name').innerText = user;
        document.getElementById('perfil-nome-grande').innerText = user;
        document.getElementById('perfil-sobrenome').innerText = user;
        document.getElementById('avatar-perfil-grande').innerText = inicial + "-";

        db.ref('usuarios/' + user).on('value', (s) => {
            const d = s.val();
            if(d) {
                document.getElementById('ftd').innerText = d.ftd || 0;
                document.getElementById('registros').innerText = d.registros || 0;
                document.getElementById('qftd').innerText = d.qftd || 0;
                document.getElementById('depositos').innerText = "R$ " + parseFloat(d.depositos || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2});
                document.getElementById('cpa').innerText = "R$ " + parseFloat(d.saldo || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2});
                document.getElementById('total').innerText = "R$ " + parseFloat(d.saldo || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2});
                document.getElementById('periodo-exibicao').innerText = (d.dataInicio || "01/01/2026") + " - " + (d.dataFim || "31/01/2026");
            }
        });

        function aplicarFiltroLocal() {
            db.ref('usuarios/' + user).update({
                dataInicio: document.getElementById('modal-ini').value.split('-').reverse().join('/'),
                dataFim: document.getElementById('modal-fim').value.split('-').reverse().join('/')
            }).then(() => {
                fecharModalFiltro();
                const t = document.getElementById("toast");
                t.className = "show";
                setTimeout(() => { t.className = t.className.replace("show", ""); }, 3000);
            });
        }

        function mudarTab(t) {
            document.getElementById('secao-overview').classList.toggle('hidden', t !== 'overview');
            document.getElementById('secao-perfil').classList.toggle('hidden', t !== 'perfil');
            document.getElementById('filtros-topo').classList.toggle('hidden', t !== 'overview');
            document.getElementById('titulo-pagina').innerText = t === 'overview' ? 'Overview' : 'Meu Perfil';
            document.getElementById('dropdown').classList.add('hidden');
        }

        function abrirModalFiltro() { document.getElementById('modal-filtro').classList.remove('hidden'); }
        function fecharModalFiltro() { document.getElementById('modal-filtro').classList.add('hidden'); }
        function toggleDropdown() { document.getElementById('dropdown').classList.toggle('hidden'); }
        function logout() { localStorage.clear(); window.location.href = 'index.html'; }
        lucide.createIcons();
    </script>
</body>
</html>
